---
import type { StoryblokClient } from "@storyblok/js";
import Main from "../layouts/Main.astro";
import { clearSlug } from "../utils/remove-end-slash";
import { storyblokApi } from "../utils/storyblok";
import { StoryblokComponent } from "@storyblok/react";
import { initStoryblok } from "../utils/init-storyblok";
export async function getStaticPaths() {
  const { data } = await (storyblokApi as StoryblokClient).get("cdn/stories", {
    version: "draft",
  });
  return data.stories.map((page: any) => {
    return {
      params: {
        slug: page.full_slug === "home" ? undefined : clearSlug(page.full_slug),
      },
      props: page,
    };
  });
}

const { slug } = Astro.params;
const page = Astro.props;

const metatags = {
  title: page.content.meta_title,
  description: page.content.meta_description,
  image: page.content.meta_image?.filename ?? "",
};

initStoryblok()

---

<Main meta={metatags}>
  {page.content.body.map((blok,index)=><StoryblokComponent key={index} blok={blok} />)}
</Main>
