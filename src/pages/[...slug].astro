---
import type { StoryblokClient } from "@storyblok/js";
import Main from "../layouts/Main.astro";
import { clearSlug } from "../utils/remove-end-slash";
import { storyblokApi } from "../utils/storyblok";
import {
  apiPlugin,
  storyblokInit,
  useStoryblok,
  StoryblokComponent,
} from "@storyblok/react";
import { bindedComponents } from "../utils/binded-component";
export async function getStaticPaths() {
  const { data } = await (storyblokApi as StoryblokClient).get("cdn/stories", {
    version: "draft",
  });
  return data.stories.map((page: any) => {
    return {
      params: {
        slug: page.full_slug === "home" ? undefined : clearSlug(page.full_slug),
        
      },
      props: page,
    };
  });
}

const { slug } = Astro.params;
const page = Astro.props;

const metatags = {
  title: page.content.meta_title,
  description: page.content.meta_description,
  image: page.content.meta_image?.filename ?? "",
};

storyblokInit({
  accessToken: import.meta.env.STORYBLOK_TOKEN,
  // bridge: true,
  use: [apiPlugin],
  components: bindedComponents,
});
---

<Main meta={metatags}>
  <StoryblokComponent blok={page.content} />
</Main>
